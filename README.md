# web3d项目文档

复旦大学2022春季高级Web技术PJ

小组成员：

- 李洋圳
- 袁逸聪
- 赵书誉
- 袁浩

## 概述

### 项目内容

本项目是一个可供多人在线的Web3D教学式场景，参与者可以在此学到最基础的编程语言知识，感受程序的魅力。

所有参与者将进入大厅，共同编写编程语言操控大厅中央桌上的方块运动。

### 工期安排

| 阶段               | 计划时间  | 工作内容                           | 完成情况 | 备注                                                                                                 |
| ------------------ | --------- | ---------------------------------- | -------- | ---------------------------------------------------------------------------------------------------- |
| 需求规划           | 4/12-4/13 | 确定项目内容，产出项目文档         | 已完成   |                                                                                                      |
| 前台搭建           | 4/13-4/20 | 完成账号管理及3D场景选择功能       | 迟滞     | 前端进度完成至注册登录跳转、搭建持久化及接口调用工具，需补充用户中心页面；后端进度完成至鉴权以外部分 |
| 前台搭建-补        | 4/21-4/24 | 补完前台搭建需求及双端测试         | 已完成   | 还需要将项目部署到云端                                                                               |
| Web3D探索          | 4/25-5/1  | 探索技术栈并确定虚拟场景的同步方案 | 已完成   | ThreeJs学习，讨论虚拟场景方案                                                                        |
| 虚拟场景           | 5/2-6/12  | 完成虚拟场景搭建                   | 已完成   | 棋盘交互逻辑、多人同步、聊天室及场景搭建                                                             |
| 功能补充及文档完善 | 6/13-6/18 | 补充场景重置和统计功能             | 已完成   |                                                                                                      |

### 分工

- 需求规划：共同完成
- 前台搭建
  - 前端：李洋圳 袁逸聪（需求对接）
  - 后端：赵书誉 袁浩（需求对接）
- 虚拟场景：袁浩 袁逸聪

- 具体负责模块
  - 李洋圳：前端搭建，前端页面美化
  - 赵书誉：数据库搭建，后端搭建，后端结构图绘制
  - 袁浩：虚拟场景环境、人物模型与动画，后端搭建，项目部署
  - 袁逸聪：虚拟场景棋盘、聊天室、socketio同步，前端搭建，文档与接口管理

## 项目需求

### 前台

1. 注册与登录
   1. 账号由邮箱、密码组成
   2. 密码要求6-18位，由数字、大写字母、小写字母组成，至少包含其中两种
   3. 邮箱不可重复注册，提供重复检验与回显提示
2. 用户后台
   1. 用户后台提供选择进入虚拟场景的链接
   2. 用户后台显示邮箱
   3. 用户后台可预览进入虚拟场景所用的虚拟形象
   4. 用户后台显示各场景使用历史
3. 虚拟场景入口
   1. 虚拟场景提供回到用户后台的链接
   2. 本阶段不必实现场景

### 虚拟场景

虚拟场景为多人在线可交互的八皇后问题

1. 棋盘
   1. 黑白相间的国际象棋棋盘
   2. 本地功能：本地玩家角色处在棋盘格子上时，显示预选指示器，表明选中的格子与选中后将被覆盖的格子范围，指示器仅在本地生效
   3. 同步功能：玩家角色处在棋盘格子上时，可以放置或拿走皇后
      1. 皇后覆盖范围内的格子无法交互
      2. 非皇后格子交互后放置皇后，同步给所有玩家
      3. 皇后格子交互后拿走皇后，同步给所有玩家
2. 玩家角色
   1. 玩家角色只能在平面上移动，通过改变自身位置选中脚下的棋盘格
   2. 本地玩家角色
      1. 本地玩家角色附带本地相机，相机以第三人称视角围绕角色转动
      2. 需要限制相机的转动范围，使其不越过地面
   3. 同步玩家角色
      1. 客户端还需要同步显示其他玩家角色的位置，但不需要渲染相机
3. 聊天室
   1. 聊天界面固定显示在屏幕下方，打开时遮盖游戏场景，不改变场景大小
   2. 按下回车打开聊天界面，打开时输入框获取焦点
   3. 输入内容再按下回车即发送，信息同步给所有在线玩家
   4. 输入框中无内容时按下回车关闭输入框

## 前端页面

1. 主页：供未登录用户浏览，介绍项目情况，并提供注册、登录页面的链接
2. 注册、登录：提供注册、登录功能，成功后跳转到用户后台
3. 用户后台：提供虚拟场景入口，可以查看虚拟场景使用历史
4. 虚拟场景

## 规范及接口

### 编码规范

本项目统一采用小驼峰法传输变量，对前端、后端及数据库都适用

对常用变量命做如下规定

| 变量 | 变量名   |
| ---- | -------- |
| 邮箱 | email    |
| 密码 | password |
| 鉴权 | token    |

### 前后端接口

本项目采用RESTFUL风格API规范

| HTTP Method | 含义 |
| ----------- | ---- |
| GET         | 获取 |
| POST        | 创建 |
| PUT         | 更新 |
| DELETE      | 删除 |

#### 接口一览

- 注册登录
  - 注册，创建账号
  - 查看邮箱重复性，查看账号
  - 登录，创建token
  - 登出，删除token
- 用户后台
  - 创建虚拟场景进入记录
  - 查看虚拟场景进入记录
- 虚拟场景
  - 用户进入虚拟场景
  - 用户通过虚拟场景
  - 查看虚拟场景进入情况
  - 查看虚拟场景通过情况

#### 接口详情

此处展示所有接口通用的返回参数

接口实际返回参数为通用参数加上各自的输出参数

| 参数  | 类型   | 含义           | 必填              | 示例               |
| ----- | ------ | -------------- | ----------------- | ------------------ |
| alert | string | 需要回显的内容 | 否 需要回显时给出 | 服务器繁忙，请重试 |

##### 查看邮箱重复性

`${ip}:${port}/api/user/account` `GET`

输入参数

| 参数  | 类型   | 含义       | 必填 | 示例                     |
| ----- | ------ | ---------- | ---- | ------------------------ |
| email | string | 所查看邮箱 | 是   | 19302010020@fudan.edu.cn |

输出参数

| 参数  | 类型   | 含义       | 必填        | 示例                     |
| ----- | ------ | ---------- | ----------- | ------------------------ |
| email | string | 查看的邮箱 | 否 存在则有 | 19302010020@fudan.edu.cn |

##### 注册

`${ip}:${port}/api/user/account` `POST`

输入参数

| 参数     | 类型   | 含义     | 必填 | 示例                     |
| -------- | ------ | -------- | ---- | ------------------------ |
| email    | string | 注册邮箱 | 是   | 19302010020@fudan.edu.cn |
| password | string | 注册密码 | 是   | abcd1234                 |

##### 登录

`${ip}:${port}/api/user/token` `POST`

输入参数

| 参数     | 类型   | 含义     | 必填 | 示例                     |
| -------- | ------ | -------- | ---- | ------------------------ |
| email    | string | 登录邮箱 | 是   | 19302010020@fudan.edu.cn |
| password | string | 登录密码 | 是   | abcd1234                 |

输出参数

| 参数  | 类型 | 含义     | 必填        | 示例   |
| ----- | ---- | -------- | ----------- | ------ |
| token | int  | 鉴权信息 | 否 成功则有 | 114514 |

##### 登出

`${ip}:${port}/api/user/token` `DELETE`

输入参数

| 参数  | 类型 | 含义     | 必填 | 示例   |
| ----- | ---- | -------- | ---- | ------ |
| token | int  | 鉴权信息 | 是   | 114514 |

##### 创建虚拟场景使用记录

`${ip}:${port}/api/scene/history` `POST`

输入参数

| 参数  | 类型   | 含义           | 必填 | 示例   |
| ----- | ------ | -------------- | ---- | ------ |
| token | int    | 鉴权信息       | 是   | 114514 |
| scene | string | 使用的虚拟场景 | 是   | 汉诺塔 |

##### 查看虚拟场景使用记录

`${ip}:${port}/api/scene/history` `GET`

输入参数

| 参数  | 类型 | 含义     | 必填 | 示例   |
| ----- | ---- | -------- | ---- | ------ |
| token | int  | 鉴权信息 | 是   | 114514 |

输出参数

| 参数    | 类型        | 含义           | 必填 | 示例                                              |
| ------- | ----------- | -------------- | ---- | ------------------------------------------------- |
| history | json object | 历史记录的list | 是   | [{'scene':"汉诺塔",'time':2022-4-13 19:39},{...}] |
